FROM ansibleplaybookbundle/apb-base:galaxy

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHZpcnR1YWxpemF0aW9uCmRlc2NyaXB0aW9uOiBLdWJlVmlydCBp\
bnN0YWxsZXIKYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gdmlydHVh\
bG1hY2hpbmUKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IEt1YmV2aXJ0CiAgbG9uZ0Rlc2NyaXB0\
aW9uOiB8CiAgICAgS3ViZVZpcnQgZW5hYmxlcyB0aGUgbWlncmF0aW9uIG9mIGV4aXN0aW5nIHZp\
cnR1YWxpemVkIHdvcmtsb2FkcyBkaXJlY3RseSBpbnRvIHRoZSBkZXZlbG9wbWVudCB3b3JrZmxv\
d3Mgc3VwcG9ydGVkIGJ5IEt1YmVybmV0ZXMuCgogICAgIFRoaXMgcHJvdmlkZXMgYSBwYXRoIHRv\
IG1vcmUgcmFwaWQgYXBwbGljYXRpb24gbW9kZXJuaXphdGlvbiBieToKICAgICAgICAgLSBTdXBw\
b3J0aW5nIGRldmVsb3BtZW50IG9mIG5ldyBtaWNyb3NlcnZpY2UgYXBwbGljYXRpb25zIGluIGNv\
bnRhaW5lcnMgdGhhdCBpbnRlcmFjdCB3aXRoIGV4aXN0aW5nIHZpcnR1YWxpemVkIGFwcGxpY2F0\
aW9ucy4KICAgICAgICAgLSBDb21iaW5pbmcgZXhpc3RpbmcgdmlydHVhbGl6ZWQgd29ya2xvYWRz\
IHdpdGggbmV3IGNvbnRhaW5lciB3b3JrbG9hZHMgb24gdGhlIHNhbWUgcGxhdGZvcm0sIHRoZXJl\
YnkgbWFraW5nIGl0IGVhc2llciB0byBkZWNvbXBvc2UgbW9ub2xpdGhpYyB2aXJ0dWFsaXplZCB3\
b3JrbG9hZHMgaW50byBjb250YWluZXJzIG92ZXIgdGltZS4KICBkb2N1bWVudGF0aW9uVXJsOiBo\
dHRwczovL2dpdGh1Yi5jb20va3ViZXZpcnQva3ViZXZpcnQvYmxvYi9tYXN0ZXIvUkVBRE1FLm1k\
CiAgaW1hZ2VVcmw6IGh0dHBzOi8vY2RuLnBicmQuY28vaW1hZ2VzL0g1R3V0ZDcucG5nCiAgcHJv\
dmlkZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCnBsYW5zOgogIC0gbmFtZTogZGVmYXVs\
dAogICAgZGVzY3JpcHRpb246IERlZmF1bHQgZGVwbG95bWVudCBwbGFuIGZvciBrdWJldmlydC1h\
cGIgd2l0aCBubyBzdG9yYWdlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IERlZmF1\
bHQKICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0\
aCBubyBzdG9yYWdlCiAgICBmcmVlOiBUcnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxl\
OiBPcGVuU2hpZnQgQWRtaW4gVXNlcgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hp\
ZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBw\
YXNzd29yZAogICAgICAtIG5hbWU6IHZlcnNpb24KICAgICAgICB0aXRsZTogVmVyc2lvbgogICAg\
ICAgIGRlZmF1bHQ6IHYwLjQuMAogICAgICAgIGVudW06IFsndjAuNC4wJywgJ3YwLjMuMCcsICd2\
MC4yLjAnLCAndjAuMS4wJ10KICAgICAgICB0eXBlOiBlbnVtCiAgICAgIC0gbmFtZTogc3RvcmFn\
ZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3RvcmFnZQogICAgICAgIGRlZmF1bHQ6IHN0\
b3JhZ2Utbm9uZQogICAgICAgIGVudW06IFsnc3RvcmFnZS1ub25lJ10KICAgICAgICB0eXBlOiBl\
bnVtCiAgLSBuYW1lOiBnbHVzdGVyCiAgICBkZXNjcmlwdGlvbjogRGVwbG95bWVudCBwbGFuIHdp\
dGggR2x1c3RlciBzdG9yYWdlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IEt1YmVW\
aXJ0IHdpdGggR2x1c3RlciBTdG9yYWdlCiAgICAgIGxvbmdEZXNjcmlwdGlvbjogVGhpcyBwbGFu\
IHByb3ZpZGVzIGt1YmV2aXJ0IHdpdGggR2x1c3RlciBzdG9yYWdlCiAgICBmcmVlOiBUcnVlCiAg\
ICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gVXNlcgogICAgICAg\
IG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDog\
dHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1l\
OiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0\
cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAtIG5hbWU6IHZlcnNpb24K\
ICAgICAgICB0aXRsZTogVmVyc2lvbgogICAgICAgIGRlZmF1bHQ6IHYwLjQuMAogICAgICAgIGVu\
dW06IFsndjAuNC4wJywgJ3YwLjMuMCcsICd2MC4yLjAnLCAndjAuMS4wJ10KICAgICAgICB0eXBl\
OiBlbnVtCiAgICAgIC0gbmFtZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQg\
U3RvcmFnZQogICAgICAgIGRlZmF1bHQ6IHN0b3JhZ2UtZ2x1c3RlcmZzCiAgICAgICAgZW51bTog\
WydzdG9yYWdlLWdsdXN0ZXJmcyddCiAgICAgICAgdHlwZTogZW51bQogIC0gbmFtZTogc3RvcmFn\
ZS1kZW1vCiAgICBkZXNjcmlwdGlvbjogRGVwbG95bWVudCBwbGFuIHdpdGggZXBoZW1lcmFsIHN0\
b3JhZ2UKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogS3ViZVZpcnQgd2l0aCBlcGhl\
bWVyYWwgU3RvcmFnZQogICAgICBsb25nRGVzY3JpcHRpb246IFRoaXMgcGxhbiBwcm92aWRlcyBr\
dWJldmlydCB3aXRoIGVwaGVtZXJhbCBzdG9yYWdlCiAgICBmcmVlOiBUcnVlCiAgICBwYXJhbWV0\
ZXJzOgogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gVXNlcgogICAgICAgIG5hbWU6IGFk\
bWluX3VzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9w\
YXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAg\
ICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAtIG5hbWU6IHZlcnNpb24KICAgICAgICB0\
aXRsZTogVmVyc2lvbgogICAgICAgIGRlZmF1bHQ6IHYwLjQuMAogICAgICAgIGVudW06IFsndjAu\
NC4wJywgJ3YwLjMuMCcsICd2MC4yLjAnLCAndjAuMS4wJ10KICAgICAgICB0eXBlOiBlbnVtCiAg\
ICAgIC0gbmFtZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3RvcmFnZQog\
ICAgICAgIGRlZmF1bHQ6IHN0b3JhZ2UtZGVtbwogICAgICAgIGVudW06IFsnc3RvcmFnZS1kZW1v\
J10KICAgICAgICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBjaW5kZXIKICAgIGRlc2NyaXB0aW9uOiBE\
ZXBsb3ltZW50IHBsYW4gZm9yIGt1YmV2aXJ0LWFwYiB3aXRoIENpbmRlciBiYWNrZW5kCiAgICBt\
ZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggQ2luZGVyIGJhY2tlbmQK\
ICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBD\
aW5kZXIgYmFja2VuZAogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRs\
ZTogT3BlblNoaWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAg\
dHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlblNo\
aWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTog\
cGFzc3dvcmQKICAgICAgLSBuYW1lOiB2ZXJzaW9uCiAgICAgICAgdGl0bGU6IFZlcnNpb24KICAg\
ICAgICBkZWZhdWx0OiB2MC40LjAKICAgICAgICBlbnVtOiBbJ3YwLjQuMCcsICd2MC4zLjAnLCAn\
djAuMi4wJywgJ3YwLjEuMCddCiAgICAgICAgdHlwZTogZW51bQogICAgICAtIG5hbWU6IHN0b3Jh\
Z2Vfcm9sZQogICAgICAgIHRpdGxlOiBCYWNrZW5kIFN0b3JhZ2UKICAgICAgICBkZWZhdWx0OiBj\
aW5kZXIKICAgICAgICBlbnVtOiBbJ2NpbmRlciddCiAgICAgICAgdHlwZTogZW51bQo="



ENV APB_ACTION_PATH="kubevirt-ansible/playbooks/kubevirt.yml"
COPY requirements.yml /opt/ansible/requirements.yml

RUN ansible-galaxy install -r /opt/ansible/requirements.yml
RUN chmod -R g=u /opt/{ansible,apb} /etc/ansible/roles

USER apb
