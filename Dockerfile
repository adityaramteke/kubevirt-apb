FROM ansibleplaybookbundle/apb-base:galaxy

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGt1YmV2aXJ0LWFwYgpkZXNjcmlwdGlvbjogQVBCIGZvciBtYW5h\
Z2luZyBLdWJlVmlydCBkZXBsb3ltZW50cwpiaW5kYWJsZTogRmFsc2UKYXN5bmM6IG9wdGlvbmFs\
Cm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBrdWJldmlydCAoQVBCKQogIGltYWdlVXJsOiBodHRw\
czovL2Nkbi5wYnJkLmNvL2ltYWdlcy9INUd1dGQ3LnBuZwpwbGFuczoKICAtIG5hbWU6IGRlZmF1\
bHQKICAgIGRlc2NyaXB0aW9uOiBEZWZhdWx0IGRlcGxveW1lbnQgcGxhbiBmb3Iga3ViZXZpcnQt\
YXBiIHdpdGggbm8gc3RvcmFnZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBEZWZh\
dWx0CiAgICAgIGxvbmdEZXNjcmlwdGlvbjogVGhpcyBwbGFuIHByb3ZpZGVzIGt1YmV2aXJ0IHdp\
dGggbm8gc3RvcmFnZQogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRs\
ZTogT3BlbnNoaWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAg\
dHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlbnNo\
aWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTog\
cGFzc3dvcmQKICAgICAgLSBuYW1lOiB0YWcKICAgICAgICB0aXRsZTogVGFnIHRvIHVzZQogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IHYwLjMuMAogIC0gbmFtZTogY25zCiAg\
ICBkZXNjcmlwdGlvbjogRGVwbG95bWVudCBwbGFuIHdpdGggQ05TCiAgICBtZXRhZGF0YToKICAg\
ICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggQ05TIFN0b3JhZ2UKICAgICAgbG9uZ0Rlc2Ny\
aXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBDTlMgc3RvcmFnZQogICAg\
ZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTogT3BlbnNoaWZ0IEFkbWlu\
IFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlbnNoaWZ0IEFkbWluIFBhc3N3b3Jk\
CiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgLSBu\
YW1lOiB0YWcKICAgICAgICB0aXRsZTogVGFnIHRvIHVzZQogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIGRlZmF1bHQ6IHYwLjMuMAogICAgICAtIG5hbWU6IHN0b3JhZ2Vfcm9sZQogICAgICAg\
IHRpdGxlOiBCYWNrZW5kIFN0b3JhZ2UKICAgICAgICBkZWZhdWx0OiBzdG9yYWdlLWNucwogICAg\
ICAgIGVudW06IFsnc3RvcmFnZS1jbnMnXQogICAgICAgIHR5cGU6IGVudW0KICAtIG5hbWU6IHN0\
b3JhZ2UtZGVtbwogICAgZGVzY3JpcHRpb246IERlcGxveW1lbnQgcGxhbiB3aXRoIGVwaGVtZXJh\
bCBzdG9yYWdlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGgg\
ZXBoZW1lcmFsIFN0b3JhZ2UKICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlk\
ZXMga3ViZXZpcnQgd2l0aCBlcGhlbWVyYWwgc3RvcmFnZQogICAgZnJlZTogVHJ1ZQogICAgcGFy\
YW1ldGVyczoKICAgICAgLSB0aXRsZTogT3BlbnNoaWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1l\
OiBhZG1pbl91c2VyCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUK\
ICAgICAgLSB0aXRsZTogT3BlbnNoaWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRt\
aW5fcGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQog\
ICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgLSBuYW1lOiB0YWcKICAgICAgICB0\
aXRsZTogVGFnIHRvIHVzZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IHYw\
LjMuMAogICAgICAtIG5hbWU6IHN0b3JhZ2Vfcm9sZQogICAgICAgIHRpdGxlOiBCYWNrZW5kIFN0\
b3JhZ2UKICAgICAgICBkZWZhdWx0OiBzdG9yYWdlLWRlbW8KICAgICAgICBlbnVtOiBbJ3N0b3Jh\
Z2UtZGVtbyddCiAgICAgICAgdHlwZTogZW51bQogIC0gbmFtZTogY2luZGVyCiAgICBkZXNjcmlw\
dGlvbjogRGVwbG95bWVudCBwbGFuIGZvciBrdWJldmlydC1hcGIgd2l0aCBDaW5kZXIgYmFja2Vu\
ZAogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBLdWJlVmlydCB3aXRoIENpbmRlciBi\
YWNrZW5kCiAgICAgIGxvbmdEZXNjcmlwdGlvbjogVGhpcyBwbGFuIHByb3ZpZGVzIGt1YmV2aXJ0\
IHdpdGggQ2luZGVyIGJhY2tlbmQKICAgIGZyZWU6IFRydWUKICAgIHBhcmFtZXRlcnM6CiAgICAg\
IC0gdGl0bGU6IE9wZW5zaGlmdCBBZG1pbiBVc2VyCiAgICAgICAgbmFtZTogYWRtaW5fdXNlcgog\
ICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6\
IE9wZW5zaGlmdCBBZG1pbiBQYXNzd29yZAogICAgICAgIG5hbWU6IGFkbWluX3Bhc3N3b3JkCiAg\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkaXNwbGF5\
X3R5cGU6IHBhc3N3b3JkCiAgICAgIC0gbmFtZTogdGFnCiAgICAgICAgdGl0bGU6IFRhZyB0byB1\
c2UKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBkZWZhdWx0OiB2MC4zLjAKICAgICAgLSBu\
YW1lOiBzdG9yYWdlX3JvbGUKICAgICAgICB0aXRsZTogQmFja2VuZCBTdG9yYWdlCiAgICAgICAg\
ZGVmYXVsdDogY2luZGVyCiAgICAgICAgZW51bTogWydjaW5kZXInXQogICAgICAgIHR5cGU6IGVu\
dW0K"


ENV APB_ACTION_PATH="kubevirt-ansible/playbooks/kubevirt.yml"
COPY requirements.yml /opt/ansible/requirements.yml

RUN ansible-galaxy install -r /opt/ansible/requirements.yml
RUN chmod -R g=u /opt/{ansible,apb} /etc/ansible/roles

USER apb
