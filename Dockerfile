FROM ansibleplaybookbundle/apb-base:galaxy

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHZpcnR1YWxpemF0aW9uCmRlc2NyaXB0aW9uOiBLdWJlVmlydCBp\
bnN0YWxsZXIKYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gdmlydHVh\
bG1hY2hpbmUKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IEt1YmV2aXJ0CiAgbG9uZ0Rlc2NyaXB0\
aW9uOiB8CiAgICAgS3ViZVZpcnQgZW5hYmxlcyB0aGUgbWlncmF0aW9uIG9mIGV4aXN0aW5nIHZp\
cnR1YWxpemVkIHdvcmtsb2FkcyBkaXJlY3RseSBpbnRvIHRoZSBkZXZlbG9wbWVudCB3b3JrZmxv\
d3Mgc3VwcG9ydGVkIGJ5IEt1YmVybmV0ZXMuCgogICAgIFRoaXMgcHJvdmlkZXMgYSBwYXRoIHRv\
IG1vcmUgcmFwaWQgYXBwbGljYXRpb24gbW9kZXJuaXphdGlvbiBieToKICAgICAgICAgLSBTdXBw\
b3J0aW5nIGRldmVsb3BtZW50IG9mIG5ldyBtaWNyb3NlcnZpY2UgYXBwbGljYXRpb25zIGluIGNv\
bnRhaW5lcnMgdGhhdCBpbnRlcmFjdCB3aXRoIGV4aXN0aW5nIHZpcnR1YWxpemVkIGFwcGxpY2F0\
aW9ucy4KICAgICAgICAgLSBDb21iaW5pbmcgZXhpc3RpbmcgdmlydHVhbGl6ZWQgd29ya2xvYWRz\
IHdpdGggbmV3IGNvbnRhaW5lciB3b3JrbG9hZHMgb24gdGhlIHNhbWUgcGxhdGZvcm0sIHRoZXJl\
YnkgbWFraW5nIGl0IGVhc2llciB0byBkZWNvbXBvc2UgbW9ub2xpdGhpYyB2aXJ0dWFsaXplZCB3\
b3JrbG9hZHMgaW50byBjb250YWluZXJzIG92ZXIgdGltZS4KICBkb2N1bWVudGF0aW9uVXJsOiBo\
dHRwczovL2dpdGh1Yi5jb20va3ViZXZpcnQva3ViZXZpcnQvYmxvYi9tYXN0ZXIvUkVBRE1FLm1k\
CiAgaW1hZ2VVcmw6IGh0dHBzOi8vY2RuLnBicmQuY28vaW1hZ2VzL0g1R3V0ZDcucG5nCiAgcHJv\
dmlkZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCnBsYW5zOgogIC0gbmFtZTogZGVmYXVs\
dAogICAgZGVzY3JpcHRpb246IERlZmF1bHQgZGVwbG95bWVudCBwbGFuIGZvciBrdWJldmlydC1h\
cGIgd2l0aCBubyBzdG9yYWdlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IERlZmF1\
bHQKICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0\
aCBubyBzdG9yYWdlCiAgICBmcmVlOiBUcnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxl\
OiBPcGVuU2hpZnQgQWRtaW4gVXNlcgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hp\
ZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBw\
YXNzd29yZAogICAgICAtIG5hbWU6IHZlcnNpb24KICAgICAgICB0aXRsZTogVmVyc2lvbgogICAg\
ICAgIGRlZmF1bHQ6IHYwLjQuMAogICAgICAgIGVudW06IFsndjAuNC4wJywgJ3YwLjQuMC1hbHBo\
YS4yJywgJ3YwLjMuMCcsICd2MC4yLjAnLCAndjAuMS4wJ10KICAgICAgICB0eXBlOiBlbnVtCiAg\
ICAgIC0gbmFtZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3RvcmFnZQog\
ICAgICAgIGRlZmF1bHQ6IHN0b3JhZ2Utbm9uZQogICAgICAgIGVudW06IFsnc3RvcmFnZS1ub25l\
J10KICAgICAgICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBnbHVzdGVyCiAgICBkZXNjcmlwdGlvbjog\
RGVwbG95bWVudCBwbGFuIHdpdGggR2x1c3RlciBzdG9yYWdlCiAgICBtZXRhZGF0YToKICAgICAg\
ZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggR2x1c3RlciBTdG9yYWdlCiAgICAgIGxvbmdEZXNj\
cmlwdGlvbjogVGhpcyBwbGFuIHByb3ZpZGVzIGt1YmV2aXJ0IHdpdGggR2x1c3RlciBzdG9yYWdl\
CiAgICBmcmVlOiBUcnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQg\
QWRtaW4gVXNlcgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gUGFz\
c3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAg\
ICAtIG5hbWU6IHZlcnNpb24KICAgICAgICB0aXRsZTogVmVyc2lvbgogICAgICAgIGRlZmF1bHQ6\
IHYwLjQuMAogICAgICAgIGVudW06IFsndjAuNC4wJywgJ3YwLjQuMC1hbHBoYS4yJywgJ3YwLjMu\
MCcsICd2MC4yLjAnLCAndjAuMS4wJ10KICAgICAgICB0eXBlOiBlbnVtCiAgICAgIC0gbmFtZTog\
c3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3RvcmFnZQogICAgICAgIGRlZmF1\
bHQ6IHN0b3JhZ2UtZ2x1c3RlcmZzCiAgICAgICAgZW51bTogWydzdG9yYWdlLWdsdXN0ZXJmcydd\
CiAgICAgICAgdHlwZTogZW51bQogIC0gbmFtZTogc3RvcmFnZS1kZW1vCiAgICBkZXNjcmlwdGlv\
bjogRGVwbG95bWVudCBwbGFuIHdpdGggZXBoZW1lcmFsIHN0b3JhZ2UKICAgIG1ldGFkYXRhOgog\
ICAgICBkaXNwbGF5TmFtZTogS3ViZVZpcnQgd2l0aCBlcGhlbWVyYWwgU3RvcmFnZQogICAgICBs\
b25nRGVzY3JpcHRpb246IFRoaXMgcGxhbiBwcm92aWRlcyBrdWJldmlydCB3aXRoIGVwaGVtZXJh\
bCBzdG9yYWdlCiAgICBmcmVlOiBUcnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxlOiBP\
cGVuU2hpZnQgQWRtaW4gVXNlcgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQg\
QWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5cGU6\
IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNz\
d29yZAogICAgICAtIG5hbWU6IHZlcnNpb24KICAgICAgICB0aXRsZTogVmVyc2lvbgogICAgICAg\
IGRlZmF1bHQ6IHYwLjQuMAogICAgICAgIGVudW06IFsndjAuNC4wJywgJ3YwLjQuMC1hbHBoYS4y\
JywgJ3YwLjMuMCcsICd2MC4yLjAnLCAndjAuMS4wJ10KICAgICAgICB0eXBlOiBlbnVtCiAgICAg\
IC0gbmFtZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3RvcmFnZQogICAg\
ICAgIGRlZmF1bHQ6IHN0b3JhZ2UtZGVtbwogICAgICAgIGVudW06IFsnc3RvcmFnZS1kZW1vJ10K\
ICAgICAgICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBjaW5kZXIKICAgIGRlc2NyaXB0aW9uOiBEZXBs\
b3ltZW50IHBsYW4gZm9yIGt1YmV2aXJ0LWFwYiB3aXRoIENpbmRlciBiYWNrZW5kCiAgICBtZXRh\
ZGF0YToKICAgICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggQ2luZGVyIGJhY2tlbmQKICAg\
ICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBDaW5k\
ZXIgYmFja2VuZAogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTog\
T3BlblNoaWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlblNoaWZ0\
IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFz\
c3dvcmQKICAgICAgLSBuYW1lOiB2ZXJzaW9uCiAgICAgICAgdGl0bGU6IFZlcnNpb24KICAgICAg\
ICBkZWZhdWx0OiB2MC40LjAKICAgICAgICBlbnVtOiBbJ3YwLjQuMCcsICd2MC40LjAtYWxwaGEu\
MicsICd2MC4zLjAnLCAndjAuMi4wJywgJ3YwLjEuMCddCiAgICAgICAgdHlwZTogZW51bQogICAg\
ICAtIG5hbWU6IHN0b3JhZ2Vfcm9sZQogICAgICAgIHRpdGxlOiBCYWNrZW5kIFN0b3JhZ2UKICAg\
ICAgICBkZWZhdWx0OiBjaW5kZXIKICAgICAgICBlbnVtOiBbJ2NpbmRlciddCiAgICAgICAgdHlw\
ZTogZW51bQo="



ENV APB_ACTION_PATH="kubevirt-ansible/playbooks/kubevirt.yml"
COPY requirements.yml /opt/ansible/requirements.yml

RUN ansible-galaxy install -r /opt/ansible/requirements.yml
RUN chmod -R g=u /opt/{ansible,apb} /etc/ansible/roles

USER apb
