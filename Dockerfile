FROM ansibleplaybookbundle/apb-base:galaxy

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGt1YmV2aXJ0LWFwYgpkZXNjcmlwdGlvbjogQVBCIGZvciBtYW5h\
Z2luZyBLdWJlVmlydCBkZXBsb3ltZW50cwpiaW5kYWJsZTogRmFsc2UKYXN5bmM6IG9wdGlvbmFs\
Cm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBrdWJldmlydCAoQVBCKQogIGltYWdlVXJsOiBodHRw\
czovL2Nkbi5wYnJkLmNvL2ltYWdlcy9INUd1dGQ3LnBuZwpwbGFuczoKICAtIG5hbWU6IGRlZmF1\
bHQKICAgIGRlc2NyaXB0aW9uOiBEZWZhdWx0IGRlcGxveW1lbnQgcGxhbiBmb3Iga3ViZXZpcnQt\
YXBiIHdpdGggbm8gc3RvcmFnZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBEZWZh\
dWx0CiAgICAgIGxvbmdEZXNjcmlwdGlvbjogVGhpcyBwbGFuIHByb3ZpZGVzIGt1YmV2aXJ0IHdp\
dGggbm8gc3RvcmFnZQogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRs\
ZTogT3BlbnNoaWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAg\
dHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlbnNo\
aWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTog\
cGFzc3dvcmQKICAgICAgLSBuYW1lOiB0YWcKICAgICAgICB0aXRsZTogVGFnIHRvIHVzZQogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IHYwLjMuMAogIC0gbmFtZTogY25zCiAg\
ICBkZXNjcmlwdGlvbjogRGVwbG95bWVudCBwbGFuIHdpdGggQ05TCiAgICBtZXRhZGF0YToKICAg\
ICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggQ05TIFN0b3JhZ2UKICAgICAgbG9uZ0Rlc2Ny\
aXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBDTlMgc3RvcmFnZQogICAg\
ZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTogT3BlbnNoaWZ0IEFkbWlu\
IFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlbnNoaWZ0IEFkbWluIFBhc3N3b3Jk\
CiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgLSBu\
YW1lOiB0YWcKICAgICAgICB0aXRsZTogVGFnIHRvIHVzZQogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIGRlZmF1bHQ6IHYwLjMuMAogICAgICAtIG5hbWU6IHN0b3JhZ2Vfcm9sZQogICAgICAg\
IHRpdGxlOiBCYWNrZW5kIFN0b3JhZ2UKICAgICAgICBkZWZhdWx0OiBjbnMKICAgICAgICBlbnVt\
OiBbJ2NucyddCiAgICAgICAgdHlwZTogZW51bQogIC0gbmFtZTogc3RvcmFnZS1kZW1vCiAgICBk\
ZXNjcmlwdGlvbjogRGVwbG95bWVudCBwbGFuIHdpdGggZXBoZW1lcmFsIHN0b3JhZ2UKICAgIG1l\
dGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogS3ViZVZpcnQgd2l0aCBlcGhlbWVyYWwgU3RvcmFn\
ZQogICAgICBsb25nRGVzY3JpcHRpb246IFRoaXMgcGxhbiBwcm92aWRlcyBrdWJldmlydCB3aXRo\
IGVwaGVtZXJhbCBzdG9yYWdlCiAgICBmcmVlOiBUcnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAt\
IHRpdGxlOiBPcGVuc2hpZnQgQWRtaW4gVXNlcgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAg\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBP\
cGVuc2hpZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90\
eXBlOiBwYXNzd29yZAogICAgICAtIG5hbWU6IHRhZwogICAgICAgIHRpdGxlOiBUYWcgdG8gdXNl\
CiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVmYXVsdDogdjAuMy4wCiAgICAgIC0gbmFt\
ZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3RvcmFnZQogICAgICAgIGRl\
ZmF1bHQ6IHN0b3JhZ2UtZGVtbwogICAgICAgIGVudW06IFsnc3RvcmFnZS1kZW1vJ10KICAgICAg\
ICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBjaW5kZXIKICAgIGRlc2NyaXB0aW9uOiBEZXBsb3ltZW50\
IHBsYW4gZm9yIGt1YmV2aXJ0LWFwYiB3aXRoIENpbmRlciBiYWNrZW5kCiAgICBtZXRhZGF0YToK\
ICAgICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggQ2luZGVyIGJhY2tlbmQKICAgICAgbG9u\
Z0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBDaW5kZXIgYmFj\
a2VuZAogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTogT3BlbnNo\
aWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAgdHlwZTogc3Ry\
aW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlbnNoaWZ0IEFkbWlu\
IFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQK\
ICAgICAgLSBuYW1lOiB0YWcKICAgICAgICB0aXRsZTogVGFnIHRvIHVzZQogICAgICAgIHR5cGU6\
IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IHYwLjMuMAogICAgICAtIG5hbWU6IHN0b3JhZ2Vfcm9s\
ZQogICAgICAgIHRpdGxlOiBCYWNrZW5kIFN0b3JhZ2UKICAgICAgICBkZWZhdWx0OiBjaW5kZXIK\
ICAgICAgICBlbnVtOiBbJ2NpbmRlciddCiAgICAgICAgdHlwZTogZW51bQo="


ENV APB_ACTION_PATH="kubevirt-ansible/playbooks/kubevirt.yml"
COPY requirements.yml /opt/ansible/requirements.yml

RUN ansible-galaxy install -r /opt/ansible/requirements.yml
RUN chmod -R g=u /opt/{ansible,apb} /etc/ansible/roles

USER apb
