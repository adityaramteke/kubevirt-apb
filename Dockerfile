FROM ansibleplaybookbundle/apb-base:galaxy

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGt1YmV2aXJ0LWFwYgpkZXNjcmlwdGlvbjogQVBCIGZvciBtYW5h\
Z2luZyBLdWJlVmlydCBkZXBsb3ltZW50cwpiaW5kYWJsZTogRmFsc2UKYXN5bmM6IG9wdGlvbmFs\
Cm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBrdWJldmlydCAoQVBCKQogIGltYWdlVXJsOiBodHRw\
czovL2Nkbi5wYnJkLmNvL2ltYWdlcy9INUd1dGQ3LnBuZwpwbGFuczoKICAtIG5hbWU6IGRlZmF1\
bHQKICAgIGRlc2NyaXB0aW9uOiBEZWZhdWx0IGRlcGxveW1lbnQgcGxhbiBmb3Iga3ViZXZpcnQt\
YXBiIHdpdGggbm8gc3RvcmFnZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBEZWZh\
dWx0CiAgICAgIGxvbmdEZXNjcmlwdGlvbjogVGhpcyBwbGFuIHByb3ZpZGVzIGt1YmV2aXJ0IHdp\
dGggbm8gc3RvcmFnZQogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRs\
ZTogT3BlbnNoaWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAg\
dHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlbnNo\
aWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTog\
cGFzc3dvcmQKICAgICAgLSBuYW1lOiB0YWcKICAgICAgICB0aXRsZTogVGFnIHRvIHVzZQogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IHYwLjMuMAogIC0gbmFtZTogc3RvcmFn\
ZS1kZW1vCiAgICBkZXNjcmlwdGlvbjogRGVwbG95bWVudCBwbGFuIHdpdGggZXBoZW1lcmFsIHN0\
b3JhZ2UKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogS3ViZVZpcnQgd2l0aCBlcGhl\
bWVyYWwgU3RvcmFnZQogICAgICBsb25nRGVzY3JpcHRpb246IFRoaXMgcGxhbiBwcm92aWRlcyBr\
dWJldmlydCB3aXRoIGVwaGVtZXJhbCBzdG9yYWdlCiAgICBmcmVlOiBUcnVlCiAgICBwYXJhbWV0\
ZXJzOgogICAgICAtIHRpdGxlOiBPcGVuc2hpZnQgQWRtaW4gVXNlcgogICAgICAgIG5hbWU6IGFk\
bWluX3VzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICAtIHRpdGxlOiBPcGVuc2hpZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9w\
YXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAg\
ICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAtIG5hbWU6IHRhZwogICAgICAgIHRpdGxl\
OiBUYWcgdG8gdXNlCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVmYXVsdDogdjAuMy4w\
CiAgICAgIC0gbmFtZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3RvcmFn\
ZQogICAgICAgIGRlZmF1bHQ6IHN0b3JhZ2UtZGVtbwogICAgICAgIGVudW06IFsnc3RvcmFnZS1k\
ZW1vJ10KICAgICAgICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBDTlMKICAgIGRlc2NyaXB0aW9uOiBE\
ZXBsb3ltZW50IHBsYW4gd2l0aCBDTlMKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTog\
S3ViZVZpcnQgd2l0aCBDTlMgU3RvcmFnZQogICAgICBsb25nRGVzY3JpcHRpb246IFRoaXMgcGxh\
biBwcm92aWRlcyBrdWJldmlydCB3aXRoIENOUyBzdG9yYWdlCiAgICBmcmVlOiBUcnVlCiAgICBw\
YXJhbWV0ZXJzOgogICAgICAtIHRpdGxlOiBPcGVuc2hpZnQgQWRtaW4gVXNlcgogICAgICAgIG5h\
bWU6IGFkbWluX3VzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1\
ZQogICAgICAtIHRpdGxlOiBPcGVuc2hpZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBh\
ZG1pbl9wYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVl\
CiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAtIG5hbWU6IHRhZwogICAgICAg\
IHRpdGxlOiBUYWcgdG8gdXNlCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVmYXVsdDog\
djAuMy4wCiAgICAgIC0gbmFtZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQg\
U3RvcmFnZQogICAgICAgIGRlZmF1bHQ6IGNucwogICAgICAgIGVudW06IFsnY25zJ10KICAgICAg\
ICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBDaW5kZXIKICAgIGRlc2NyaXB0aW9uOiBEZXBsb3ltZW50\
IHBsYW4gZm9yIGt1YmV2aXJ0LWFwYiB3aXRoIENpbmRlciBiYWNrZW5kCiAgICBtZXRhZGF0YToK\
ICAgICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggQ2luZGVyIGJhY2tlbmQKICAgICAgbG9u\
Z0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBDaW5kZXIgYmFj\
a2VuZAogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTogT3BlbnNo\
aWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAgdHlwZTogc3Ry\
aW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlbnNoaWZ0IEFkbWlu\
IFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQK\
ICAgICAgLSBuYW1lOiB0YWcKICAgICAgICB0aXRsZTogVGFnIHRvIHVzZQogICAgICAgIHR5cGU6\
IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IHYwLjMuMAogICAgICAtIG5hbWU6IHN0b3JhZ2Vfcm9s\
ZQogICAgICAgIHRpdGxlOiBCYWNrZW5kIFN0b3JhZ2UKICAgICAgICBkZWZhdWx0OiBjaW5kZXIK\
ICAgICAgICBlbnVtOiBbJ2NpbmRlciddCiAgICAgICAgdHlwZTogZW51bQo="


ENV APB_ACTION_PATH="kubevirt-ansible/playbooks/kubevirt.yml"
COPY requirements.yml /opt/ansible/requirements.yml

RUN ansible-galaxy install -r /opt/ansible/requirements.yml
RUN chmod -R g=u /opt/{ansible,apb} /etc/ansible/roles

USER apb
